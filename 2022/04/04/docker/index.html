

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon.png">
  <link rel="icon" href="/images/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Nanbert">
  <meta name="keywords" content="">
  
    <meta name="description" content="各个文件位置 本地资源的默认总目录：&#x2F;var&#x2F;lib&#x2F;docker&#x2F;,迁移docker就是复制该文件夹，重置就是删除该文件夹 容器信息：containers 镜像信息：image 镜像层文件：overlay2  修改文件位置 方式1：为默认位置建立软链接 方式2：daemon启动时指定-g选项 方式3：修改&#x2F;etc&#x2F;docker&#x2F;daemon.json的”data-r">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="http://example.com/2022/04/04/docker/index.html">
<meta property="og:site_name" content="Nanbert&#39;s blog">
<meta property="og:description" content="各个文件位置 本地资源的默认总目录：&#x2F;var&#x2F;lib&#x2F;docker&#x2F;,迁移docker就是复制该文件夹，重置就是删除该文件夹 容器信息：containers 镜像信息：image 镜像层文件：overlay2  修改文件位置 方式1：为默认位置建立软链接 方式2：daemon启动时指定-g选项 方式3：修改&#x2F;etc&#x2F;docker&#x2F;daemon.json的”data-r">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/docker.png">
<meta property="article:published_time" content="2022-04-03T19:51:08.000Z">
<meta property="article:modified_time" content="2023-12-12T06:06:27.738Z">
<meta property="article:author" content="Nanbert">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/docker.png">
  
  
  
  <title>docker - Nanbert&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.6","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/images/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Nanbert</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/images/docker.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="docker"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-04-04 03:51" pubdate>
          2022年4月4日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          26 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">docker</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="各个文件位置"><a href="#各个文件位置" class="headerlink" title="各个文件位置"></a>各个文件位置</h2><ul>
<li>本地资源的默认总目录：<code>/var/lib/docker/</code>,<strong>迁移</strong>docker就是复制该文件夹，<strong>重置</strong>就是删除该文件夹</li>
<li>容器信息：<code>containers</code></li>
<li>镜像信息：<code>image</code></li>
<li>镜像层文件：<code>overlay2</code></li>
</ul>
<h3 id="修改文件位置"><a href="#修改文件位置" class="headerlink" title="修改文件位置"></a>修改文件位置</h3><ul>
<li>方式1：为默认位置建立软链接</li>
<li>方式2：daemon启动时指定-g选项</li>
<li>方式3：修改&#x2F;etc&#x2F;docker&#x2F;daemon.json的”data-root”项</li>
</ul>
<h2 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h2><ul>
<li>查看是否在docker.service文件中配置过镜像地址：<code>$ systemctl cat docker | grep &#39;\-\-registry\-mirror&#39;</code></li>
<li>上一步如果出现输出内容，修改文件去掉内容<code>--registry-mirror</code>，按接下来步骤配置</li>
<li>在&#x2F;etc&#x2F;docker&#x2F;daemon.json中写入下面内容：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<br>    <span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>,<br>    <span class="hljs-string">&quot;https://mirror.baidubce.com&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>重启服务：<code>sudo systemctl daemon-reload;sudo systemctl restart docker</code></li>
<li>检查是否生效：<code>docker info</code></li>
</ul>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><ul>
<li>格式:<code>docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></li>
<li>默认地址是<code>docker.io</code>,仓库名默认为<code>library</code>,即官方镜像，标签默认是<code>latest</code></li>
<li>简化版：<code>docker pull ubuntu</code></li>
</ul>
<h3 id="列出镜像"><a href="#列出镜像" class="headerlink" title="列出镜像"></a>列出镜像</h3><ul>
<li>一般命令：<code>docker image ls</code></li>
</ul>
<table>
<thead>
<tr>
<th align="center">选项</th>
<th align="center">含义</th>
<th align="center">举例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a</td>
<td align="center">显示包括中间层镜像在内的所有镜像</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-f&#x2F;–fliter</td>
<td align="center">过滤参数,见下</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">–format</td>
<td align="center">自定义格式，见</td>
<td align="center"><code>docker image ls --format &quot;&#123;&#123;.ID&#125;&#125;: &#123;&#123;.Repository&#125;&#125;&quot;</code></td>
</tr>
</tbody></table>
<h4 id="f选项"><a href="#f选项" class="headerlink" title="-f选项"></a>-f选项</h4><ul>
<li>since&#x2F;before: <code>docker image ls -f since=mongo:3.2</code>,列出mongo:3.2之后建立的镜像</li>
<li>label: <code>docker image ls -f label=com.example.version=0.1</code></li>
</ul>
<h4 id="虚悬镜像"><a href="#虚悬镜像" class="headerlink" title="&lt;none&gt;虚悬镜像"></a><code>&lt;none&gt;</code>虚悬镜像</h4><ul>
<li>原因：docker pull或docker build导致镜像名被转移到最新版</li>
<li>只列出虚悬镜像：<code>docker image ls -f dangling=true</code></li>
<li>删除虚悬镜像：<code>docker image prune</code></li>
</ul>
<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><ul>
<li>格式：<code>docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; ...]</code>,镜像可以是长&#x2F;短id,镜像名或镜像摘要</li>
</ul>
<h4 id="untagged和deleted"><a href="#untagged和deleted" class="headerlink" title="untagged和deleted"></a>untagged和deleted</h4><p>镜像对应多个tag,，只有所有tag都为untagged时，才真正删除，如果一个容器依赖一个镜像，要先删除容器，才能再删除镜像</p>
<h3 id="docker-commit-添加一层形成新的镜像（慎用）"><a href="#docker-commit-添加一层形成新的镜像（慎用）" class="headerlink" title="docker commit-添加一层形成新的镜像（慎用）"></a>docker commit-添加一层形成新的镜像（慎用）</h3><ul>
<li>说明：该命令会使一个容器形成一个新的镜像,最好不要这样，而是使用Dockerfile</li>
<li>格式：<code>docker commit [选项] &lt;容器ID或容器名&gt; [仓库名:标签]</code></li>
</ul>
<table>
<thead>
<tr>
<th align="center">选项</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">–author</td>
<td align="center">说明作者</td>
</tr>
<tr>
<td align="center">–message</td>
<td align="center">添加说明信息</td>
</tr>
</tbody></table>
<h4 id="docker-history"><a href="#docker-history" class="headerlink" title="docker history"></a>docker history</h4><ul>
<li>说明：该命令用来查看某个镜像的提交历史</li>
<li>示例：<code>docker history [仓库名:标签]</code></li>
</ul>
<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><h3 id="容器运行流程"><a href="#容器运行流程" class="headerlink" title="容器运行流程"></a>容器运行流程</h3><ol>
<li>检查本地是否存在指定的镜像，不存在就从registry下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li>
<li>从地址池配置一个ip地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止</li>
</ol>
<h3 id="运行容器docker-run"><a href="#运行容器docker-run" class="headerlink" title="运行容器docker run"></a>运行容器<code>docker run</code></h3><ul>
<li><strong>格式：</strong><code>docker run [OPTIONS] image</code></li>
</ul>
<table>
<thead>
<tr>
<th align="center">选项</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-c&#x2F;–cpu-shares</td>
<td align="center">调整容器使用cpu的权重</td>
</tr>
<tr>
<td align="center">-d</td>
<td align="center">后台运行，此时容器不会把输出的结果打印到宿主机上面，<code>docker container logs &lt;container id or name&gt;</code>可以查看结果</td>
</tr>
<tr>
<td align="center">–dns&#x3D;[ip_address]</td>
<td align="center">设置dns服务器</td>
</tr>
<tr>
<td align="center">–dns-search&#x3D;[DOMAIN]</td>
<td align="center">设定容器搜索域</td>
</tr>
<tr>
<td align="center">–env [VAR&#x3D;value]</td>
<td align="center">传递环境变量</td>
</tr>
<tr>
<td align="center">–env-file [file]</td>
<td align="center">从file中引入环境变量</td>
</tr>
<tr>
<td align="center">-h&#x2F;–hostname&#x3D;[HOSTNAME]</td>
<td align="center">设定容器主机名，比较鸡肋，只能在容器内部显示</td>
</tr>
<tr>
<td align="center">-i</td>
<td align="center">交互式操作,让容器的标准输入保持打开</td>
</tr>
<tr>
<td align="center">-m</td>
<td align="center">–memory[&#x3D;MEMORY]</td>
</tr>
<tr>
<td align="center">–mount</td>
<td align="center">挂载数据卷或主机目录</td>
</tr>
<tr>
<td align="center">–name [name]</td>
<td align="center">指定容器的名字</td>
</tr>
<tr>
<td align="center">–network [my-net]</td>
<td align="center">见连接容器</td>
</tr>
<tr>
<td align="center">-p</td>
<td align="center">见端口映射</td>
</tr>
<tr>
<td align="center">-P</td>
<td align="center">随机映射镜像的端口</td>
</tr>
<tr>
<td align="center">–rm</td>
<td align="center">容器退出后随之将其删除</td>
</tr>
<tr>
<td align="center">-t</td>
<td align="center">代表终端，让Docker分配一个伪终端并邦到标准输入</td>
</tr>
<tr>
<td align="center">-u&#x3D;[username]</td>
<td align="center">设置进程用户名</td>
</tr>
<tr>
<td align="center">-v [宿主机路径]:[容器路径]</td>
<td align="center">映射路径</td>
</tr>
<tr>
<td align="center">–volumes-from</td>
<td align="center">从别的容器中挂载卷</td>
</tr>
</tbody></table>
<h3 id="查看容器的信息–docker-container-ls"><a href="#查看容器的信息–docker-container-ls" class="headerlink" title="查看容器的信息–docker container ls"></a>查看容器的信息–docker container ls</h3><ul>
<li><strong>格式：</strong><code>docker container ls</code></li>
<li>-a:列出终止状态的容器</li>
</ul>
<h3 id="终止容器–docker-container-stop"><a href="#终止容器–docker-container-stop" class="headerlink" title="终止容器–docker container stop"></a>终止容器–docker container stop</h3><ul>
<li><strong>格式：</strong><code>docker container stop [container id or names]</code></li>
</ul>
<h3 id="启动已终止容器–docker-container-start"><a href="#启动已终止容器–docker-container-start" class="headerlink" title="启动已终止容器–docker container start"></a>启动已终止容器–docker container start</h3><ul>
<li><strong>格式：</strong><code>docker container start [container id or names]</code></li>
</ul>
<h3 id="重启容器–docker-container-restart"><a href="#重启容器–docker-container-restart" class="headerlink" title="重启容器–docker container restart"></a>重启容器–docker container restart</h3><ul>
<li><strong>格式：</strong><code>docker container restart [container id or names]</code></li>
</ul>
<h3 id="查看容器的日志–docker-container-logs"><a href="#查看容器的日志–docker-container-logs" class="headerlink" title="查看容器的日志–docker container logs"></a>查看容器的日志–docker container logs</h3><ul>
<li><strong>格式：</strong><code>docker container logs [container ID or NAMES]</code></li>
</ul>
<h3 id="进入后台运行的容器–docker-attach-exec"><a href="#进入后台运行的容器–docker-attach-exec" class="headerlink" title="进入后台运行的容器–docker attach&#x2F;exec"></a>进入后台运行的容器–docker attach&#x2F;exec</h3><ul>
<li>建议使用exec,使用attach,从stdin退出，会导致容器的停止，exec就没这个问题</li>
<li>attach格式：<code>docker attach [id or names]</code></li>
</ul>
<h4 id="docker-exec"><a href="#docker-exec" class="headerlink" title="docker exec"></a>docker exec</h4><ul>
<li><strong>格式：</strong><code>docker exec -it [id or names]</code></li>
<li>-it选项和docker run一样</li>
</ul>
<h3 id="导出、导入容器–docker-export-import"><a href="#导出、导入容器–docker-export-import" class="headerlink" title="导出、导入容器–docker export&#x2F;import"></a>导出、导入容器–docker export&#x2F;import</h3><ul>
<li>导出容器：<code>docker export [id] &gt; xx.tar</code></li>
<li>导入容器快照成镜像：<code>cat xx.tar | docker import - test/ubuntu:v1.0</code>,支持url:<code>$ docker import http://example.com/exampleimage.tgz example/imagerepo</code></li>
<li>docker load和docker import:docker import会丢弃所有历史记录和元数据信息，docker load则会保留完整记录</li>
</ul>
<h3 id="删除容器–docker-container-rm"><a href="#删除容器–docker-container-rm" class="headerlink" title="删除容器–docker container rm"></a>删除容器–docker container rm</h3><ul>
<li><strong>格式：</strong><code>docker container rm [container id or names]</code></li>
<li>-f:删除一个运行中的容器</li>
</ul>
<h2 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h2><h3 id="Docker-Hub"><a href="#Docker-Hub" class="headerlink" title="Docker Hub"></a>Docker Hub</h3><ul>
<li>注册：在官网<a target="_blank" rel="noopener" href="https://hub.docker.com免费注册一个docker帐号/">https://hub.docker.com免费注册一个Docker帐号</a></li>
<li>登录：<code>docker login</code>命令交互式输入用户名和密码</li>
<li>搜索：<code>docker search [关键字]</code>支持<code>--filter=stars=N</code>仅显示收藏数量N以上的镜像</li>
<li>拉取：见镜像拉取</li>
<li>推送：推送前先标记下<code>dockeer tag [image:tag] [username/xx:xx]</code>，<code>docker push username/xx:xx</code></li>
</ul>
<h3 id="私有仓库–-docker-registry"><a href="#私有仓库–-docker-registry" class="headerlink" title="私有仓库–&gt;docker-registry"></a>私有仓库–&gt;docker-registry</h3><ul>
<li>使用官方registry镜像：<code>$ docker run -d -p 5000:5000 --restart=always --name registry registry</code></li>
<li>默认情况下仓库会在容器中的<code>/var/lib/registry</code>目录下,可以用-v选项映射</li>
<li>标记镜像<code>git tag</code>:<code>docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]</code></li>
<li>推送：<code>docker push 127.0.0.1:5000/ubuntu:latest</code></li>
<li>拉取：<code>docker pull 127.0.0.1:5000/ubuntu:latest</code></li>
<li>取消非https限制：默认情况下docker不允许非https方式推送，对于使用systemd的系统，可以在&#x2F;etc&#x2F;docker&#x2F;daemon.json中写入如下内容：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>  <span class="hljs-string">&quot;registry-mirror&quot;</span>: [<br>    <span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>,<br>    <span class="hljs-string">&quot;https://mirror.baidubce.com&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;insecure-registries&quot;</span>: [<br>    <span class="hljs-string">&quot;192.168.199.100:5000&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>私有仓库删除镜像可能不会回收空间，可以使用Nexus3.x软件搭配</li>
</ul>
<h2 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h2><h3 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h3><ul>
<li>特性<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新，不会影响镜像</li>
<li>数据卷会默认一直存在，即使容器被删除</li>
</ul>
</li>
<li>创建一个数据卷：<code>docker volume create my-vol</code></li>
<li>查看数据卷：<code>docker volume ls</code></li>
<li>查看指定数据卷信息：<code>docker volume inspect my-vol</code></li>
<li>挂载数据卷<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -P \<br>    --name web \<br>    <span class="hljs-comment"># -v my-vol:/usr/share/nginx/html \</span><br>    --mount <span class="hljs-built_in">source</span>=my-vol,target=/usr/share/nginx/html \<br>    nginx:alpine<br></code></pre></td></tr></table></figure></li>
<li>删除数据卷：<code>docker volume rm my-vol</code></li>
</ul>
<h3 id="挂载主机目录为数据卷"><a href="#挂载主机目录为数据卷" class="headerlink" title="挂载主机目录为数据卷"></a>挂载主机目录为数据卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 可以不加readonly,那样权限就是读写</span><br>docker run -d -P \<br>    --name web \<br>    <span class="hljs-comment"># -v /src/webapp:/usr/share/nginx/html:ro \</span><br>    --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,<span class="hljs-built_in">source</span>=/src/webapp,target=/usr/share/nginx/html,<span class="hljs-built_in">readonly</span> \<br>    nginx:alpine<br></code></pre></td></tr></table></figure>
<p>可以挂载指定文件，把上面source和target换成文件即可</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><p>使用-p选项</p>
<ul>
<li>映射所有接口地址：<code>-p hostPort:containerPort</code></li>
<li>映射到指定地址的指定端口：<code>-p ip:hostPort:containerPort</code></li>
<li>映射到指定地址的任意端口：<code>-p ip::containerPort</code></li>
<li>标记udp: <code>-p xxport:xxport/udp</code></li>
<li>查看容器的端口映射：<code>docker port [id or name] [containerPort]</code></li>
</ul>
<h3 id="容器互联-两个容器"><a href="#容器互联-两个容器" class="headerlink" title="容器互联(两个容器)"></a>容器互联(两个容器)</h3><p>如果大于两个容器的互联建议使用Docker Compose</p>
<ul>
<li>新建网络：<code>docker network create -d bridge my-net</code>,-d选项有bridge和overlay(见swarm mode)</li>
<li>连接容器：<code>$ docker run -it --rm --name busybox1 --network my-net busybox sh</code>,<code>$ docker run -it --rm --name busybox1 --network my-net busybox2 sh</code></li>
<li>在各个容器中ping：<code>ping busybox2</code></li>
</ul>
<h3 id="DNS配置"><a href="#DNS配置" class="headerlink" title="DNS配置"></a>DNS配置</h3><p>容器的DNS设置跟随宿主主机，默认使用主机上的&#x2F;etc&#x2F;resolv.conf(–dns-search –dns会改变默认设置),如果配置全部容器的DNS可以在<code>/etc/docker/daemon.json</code>增加以下内容设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>  <span class="hljs-string">&quot;dns&quot;</span> : [<br>    <span class="hljs-string">&quot;114.114.114.114&quot;</span>,<br>    <span class="hljs-string">&quot;8.8.8.8&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="docker命令汇总"><a href="#docker命令汇总" class="headerlink" title="docker命令汇总"></a>docker命令汇总</h2><h3 id="客户端选项"><a href="#客户端选项" class="headerlink" title="客户端选项"></a>客户端选项</h3><ul>
<li>–config&#x3D;””：指定客户端配置文件，默认为 ~&#x2F;.docker；</li>
<li>-D&#x3D;true|false：是否使用 debug 模式。默认不开启；</li>
<li>-H, –host&#x3D;[]：指定命令对应 Docker 守护进程的监听接口，可以为 unix 套接字 unix:&#x2F;&#x2F;&#x2F;path&#x2F;to&#x2F;socket，文件句柄 fd:&#x2F;&#x2F;socketfd 或 tcp 套接字 tcp:&#x2F;&#x2F;[host[:port]]，默认为 unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock；</li>
<li>-l, –log-level&#x3D;”debug|info|warn|error|fatal”：指定日志输出级别；</li>
<li>–tls&#x3D;true|false：是否对 Docker 守护进程启用 TLS 安全机制，默认为否；</li>
<li>–tlscacert&#x3D;&#x2F;.docker&#x2F;ca.pem：TLS CA 签名的可信证书文件路径；</li>
<li>–tlscert&#x3D;&#x2F;.docker&#x2F;cert.pem：TLS 可信证书文件路径；</li>
<li>–tlscert&#x3D;&#x2F;.docker&#x2F;key.pem：TLS 密钥文件路径；</li>
<li>–tlsverify&#x3D;true|false：启用 TLS 校验，默认为否。</li>
</ul>
<h3 id="客户端命令"><a href="#客户端命令" class="headerlink" title="客户端命令"></a>客户端命令</h3><ul>
<li>attach：依附到一个正在运行的容器中；</li>
<li>build：从一个 Dockerfile 创建一个镜像；</li>
<li>commit：从一个容器的修改中创建一个新的镜像；</li>
<li>cp：在容器和本地宿主系统之间复制文件中；</li>
<li>create：创建一个新容器，但并不运行它；</li>
<li>diff：检查一个容器内文件系统的修改，包括修改和增加；</li>
<li>events：从服务端获取实时的事件；</li>
<li>exec：在运行的容器内执行命令；</li>
<li>export：导出容器内容为一个 tar 包；</li>
<li>history：显示一个镜像的历史信息；</li>
<li>images：列出存在的镜像；</li>
<li>import：导入一个文件（典型为 tar 包）路径或目录来创建一个本地镜像；</li>
<li>info：显示一些相关的系统信息；</li>
<li>inspect：显示一个容器的具体配置信息；</li>
<li>kill：关闭一个运行中的容器 (包括进程和所有相关资源)；</li>
<li>load：从一个 tar 包中加载一个镜像；</li>
<li>login：注册或登录到一个 Docker 的仓库服务器；</li>
<li>logout：从 Docker 的仓库服务器登出；</li>
<li>logs：获取容器的 log 信息；</li>
<li>network：管理 Docker 的网络，包括查看、创建、删除、挂载、卸载等；</li>
<li>node：管理 swarm 集群中的节点，包括查看、更新、删除、提升&#x2F;取消管理节点等；</li>
<li>pause：暂停一个容器中的所有进程；</li>
<li>port：查找一个 nat 到一个私有网口的公共口；</li>
<li>ps：列出主机上的容器；</li>
<li>pull：从一个Docker的仓库服务器下拉一个镜像或仓库；</li>
<li>push：将一个镜像或者仓库推送到一个 Docker 的注册服务器；</li>
<li>rename：重命名一个容器；</li>
<li>restart：重启一个运行中的容器；</li>
<li>rm：删除给定的若干个容器；</li>
<li>rmi：删除给定的若干个镜像；</li>
<li>run：创建一个新容器，并在其中运行给定命令；</li>
<li>save：保存一个镜像为 tar 包文件；</li>
<li>search：在 Docker index 中搜索一个镜像；</li>
<li>service：管理 Docker 所启动的应用服务，包括创建、更新、删除等；</li>
<li>start：启动一个容器；</li>
<li>stats：输出（一个或多个）容器的资源使用统计信息；</li>
<li>stop：终止一个运行中的容器；</li>
<li>swarm：管理 Docker swarm 集群，包括创建、加入、退出、更新等；</li>
<li>tag：为一个镜像打标签；</li>
<li>top：查看一个容器中的正在运行的进程信息；</li>
<li>unpause：将一个容器内所有的进程从暂停状态中恢复；</li>
<li>update：更新指定的若干容器的配置信息；</li>
<li>version：输出 Docker 的版本信息；</li>
<li>volume：管理 Docker volume，包括查看、创建、删除等；</li>
<li>wait：阻塞直到一个容器终止，然后输出它的退出符。</li>
</ul>
<h3 id="服务端命令选项"><a href="#服务端命令选项" class="headerlink" title="服务端命令选项"></a>服务端命令选项</h3><ul>
<li>–api-cors-header&#x3D;””：CORS 头部域，默认不允许 CORS，要允许任意的跨域访问，可以指定为 <code>*</code>；</li>
<li>–authorization-plugin&#x3D;””：载入认证的插件；</li>
<li>-b&#x3D;””：将容器挂载到一个已存在的网桥上。指定为 none 时则禁用容器的网络，与 –bip 选项互斥；</li>
<li>–bip&#x3D;””：让动态创建的 docker0 网桥采用给定的 CIDR 地址; 与 -b 选项互斥；</li>
<li>–cgroup-parent&#x3D;””：指定 cgroup 的父组，默认 fs cgroup 驱动为 &#x2F;docker，systemd cgroup 驱动为 system.slice；</li>
<li>–cluster-store&#x3D;””：构成集群（如 Swarm）时，集群键值数据库服务地址；</li>
<li>–cluster-advertise&#x3D;””：构成集群时，自身的被访问地址，可以为 host:port 或 interface:port；</li>
<li>–cluster-store-opt&#x3D;””：构成集群时，键值数据库的配置选项；</li>
<li>–config-file&#x3D;”&#x2F;etc&#x2F;docker&#x2F;daemon.json”：daemon 配置文件路径；</li>
<li>–containerd&#x3D;””：containerd 文件的路径；</li>
<li>-D, –debug&#x3D;true|false：是否使用 Debug 模式。缺省为 false；</li>
<li>–default-gateway&#x3D;””：容器的 IPv4 网关地址，必须在网桥的子网段内；</li>
<li>–default-gateway-v6&#x3D;””：容器的 IPv6 网关地址；</li>
<li>–default-ulimit&#x3D;[]：默认的 ulimit 值；</li>
<li>–disable-legacy-registry&#x3D;true|false：是否允许访问旧版本的镜像仓库服务器；</li>
<li>–dns&#x3D;””：指定容器使用的 DNS 服务器地址；</li>
<li>–dns-opt&#x3D;””：DNS 选项；</li>
<li>–dns-search&#x3D;[]：DNS 搜索域；</li>
<li>–exec-opt&#x3D;[]：运行时的执行选项；</li>
<li>–exec-root&#x3D;””：容器执行状态文件的根路径，默认为 &#x2F;var&#x2F;run&#x2F;docker；</li>
<li>–fixed-cidr&#x3D;””：限定分配 IPv4 地址范围；</li>
<li>–fixed-cidr-v6&#x3D;””：限定分配 IPv6 地址范围；</li>
<li>-G, –group&#x3D;””：分配给 unix 套接字的组，默认为 docker；</li>
<li>-g, –graph&#x3D;””：Docker 运行时的根路径，默认为 &#x2F;var&#x2F;lib&#x2F;docker；</li>
<li>-H, –host&#x3D;[]：指定命令对应 Docker daemon 的监听接口，可以为 unix 套接字 unix:&#x2F;&#x2F;&#x2F;path&#x2F;to&#x2F;socket，文件句柄 fd:&#x2F;&#x2F;socketfd 或 tcp 套接字 tcp:&#x2F;&#x2F;[host[:port]]，默认为 unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock；</li>
<li>–icc&#x3D;true|false：是否启用容器间以及跟 daemon 所在主机的通信。默认为 true。</li>
<li>–insecure-registry&#x3D;[]：允许访问给定的非安全仓库服务；</li>
<li>–ip&#x3D;””：绑定容器端口时候的默认 IP 地址。缺省为 0.0.0.0；</li>
<li>–ip-forward&#x3D;true|false：是否检查启动在 Docker 主机上的启用 IP 转发服务，默认开启。注意关闭该选项将不对系统转发能力进行任何检查修改；</li>
<li>–ip-masq&#x3D;true|false：是否进行地址伪装，用于容器访问外部网络，默认开启；</li>
<li>–iptables&#x3D;true|false：是否允许 Docker 添加 iptables 规则。缺省为 true；</li>
<li>–ipv6&#x3D;true|false：是否启用 IPv6 支持，默认关闭；</li>
<li>-l, –log-level&#x3D;”debug|info|warn|error|fatal”：指定日志输出级别；</li>
<li>–label&#x3D;”[]”：添加指定的键值对标注；</li>
<li>–log-driver&#x3D;”json-file|syslog|journald|gelf|fluentd|awslogs|splunk|etwlogs|gcplogs|none”：指定日志后端驱动，默认为 json-file；</li>
<li>–log-opt&#x3D;[]：日志后端的选项；</li>
<li>–mtu&#x3D;VALUE：指定容器网络的 mtu；</li>
<li>-p&#x3D;””：指定 daemon 的 PID 文件路径。缺省为 &#x2F;var&#x2F;run&#x2F;docker.pid；</li>
<li>–raw-logs：输出原始，未加色彩的日志信息；</li>
<li>–registry-mirror&#x3D;<scheme>:&#x2F;&#x2F;<host>：指定 docker pull 时使用的注册服务器镜像地址；</li>
<li>-s, –storage-driver&#x3D;””：指定使用给定的存储后端；</li>
<li>–selinux-enabled&#x3D;true|false：是否启用 SELinux 支持。缺省值为 false。SELinux 目前尚不支持 overlay 存储驱动；</li>
<li>–storage-opt&#x3D;[]：驱动后端选项；</li>
<li>–tls&#x3D;true|false：是否对 Docker daemon 启用 TLS 安全机制，默认为否；</li>
<li>–tlscacert&#x3D;&#x2F;.docker&#x2F;ca.pem：TLS CA 签名的可信证书文件路径；</li>
<li>–tlscert&#x3D;&#x2F;.docker&#x2F;cert.pem：TLS 可信证书文件路径；</li>
<li>–tlscert&#x3D;&#x2F;.docker&#x2F;key.pem：TLS 密钥文件路径；</li>
<li>–tlsverify&#x3D;true|false：启用 TLS 校验，默认为否；</li>
<li>–userland-proxy&#x3D;true|false：是否使用用户态代理来实现容器间和出容器的回环通信，默认为 true；</li>
<li>–userns-remap&#x3D;default|uid:gid|user:group|user|uid：指定容器的用户命名空间，默认是创建新的 UID 和 GID 映射到容器内进程。</li>
</ul>
<h2 id="调试docker"><a href="#调试docker" class="headerlink" title="调试docker"></a>调试docker</h2><ul>
<li>开启debug模式：在&#x2F;etc&#x2F;docker&#x2F;daemon.json中添加：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>	<span class="hljs-string">&quot;debug&quot;</span>:<span class="hljs-literal">true</span>	<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>重启守护进程<code>sudo kill -SIGHUP $(pidof dockerd)</code></li>
<li>检查内核日志<code>sudo dmesg | grep dockerd</code>,<code>sudo dmesg|grep runc</code></li>
<li>不响应时，杀死进程查看堆栈：<code>sudo kill -SIGUSR1 $(pidof dockerd)</code></li>
</ul>
<h2 id="高级网络"><a href="#高级网络" class="headerlink" title="高级网络"></a>高级网络</h2><h2 id="集群–Swarm-mod"><a href="#集群–Swarm-mod" class="headerlink" title="集群–Swarm mod"></a>集群–Swarm mod</h2><h2 id="Docker-Buildx–-未来docker-build"><a href="#Docker-Buildx–-未来docker-build" class="headerlink" title="Docker Buildx–&gt;未来docker build"></a>Docker Buildx–&gt;未来docker build</h2><h2 id="常用命令及问题"><a href="#常用命令及问题" class="headerlink" title="常用命令及问题"></a>常用命令及问题</h2><ul>
<li><code>docker system df</code>查看镜像、容器、数据卷所占用空间</li>
<li><code>docker image prune</code>批量清理临时镜像</li>
<li><code>docker container prune</code>删除所有终止状态的容器</li>
<li><code>docker volume prune</code>删除无主的数据卷</li>
<li><code>docker run [image] env</code>查看镜像支持的环境变量</li>
<li><code>docker stop $(docker container ls -q)</code>停止所有正在运行的容器</li>
<li><code>docker inspect --format &#39;&#123;&#123; .State.Pid &#125;&#125;&#39; &lt;CONTAINER ID or NAME&gt;</code>获取某个容器的PID信息</li>
<li><code>docker inspect --format &#39;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#39; &lt;CONTAINER ID or NAME&gt;</code>获取某个容器的ip地址</li>
<li>给容器指定一个固定ip地址<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker network create -d bridge --subnet 172.25.0.0/16 my-net<br>docker run --network=my-net --ip=172.25.3.3 -itd --name=my-container busybox<br></code></pre></td></tr></table></figure></li>
<li>退出一个交互的终端而不终止，按<code>ctrl-p ctrl-q</code></li>
<li>Error:No public port 80 published for xxx<ul>
<li>创建镜像时 Dockerfile 要通过 EXPOSE 指定正确的开放端口；</li>
<li>容器启动时指定 PublishAllPort &#x3D; true。</li>
</ul>
</li>
<li>WARNING: Your kernel does not support cgroup swap limit. WARNING: Your kernel does not support swap limit capabilities. Limitation discarded.<br>这是因为系统默认没有开启对内存和swap使用的统计功能，该功能会降低性能，可以通过以下方式开启：<ul>
<li>编辑<code>/etc/default/grub</code>配置<code>GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;</code></li>
<li>更新grub:<code>sudo update-grub</code></li>
<li>重启</li>
</ul>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>docker</div>
      <div>http://example.com/2022/04/04/docker/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Nanbert</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年4月4日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/04/Dockerfile/" title="Dockerfile">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Dockerfile</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/22/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E7%91%9E%E5%A3%AB%E5%86%9B%E5%88%80-%E6%89%A9%E5%B1%95/" title="文本处理瑞士军刀-扩展">
                        <span class="hidden-mobile">文本处理瑞士军刀-扩展</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
