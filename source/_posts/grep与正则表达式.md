---
title: grep与正则表达式
date: 2020-11-20 19:46:54
subtitle:
categories:
tags:
index_img: /img/regex.jpg
banner_img: /img/regex.jpg
---
# grep
格式:`grep [options] [regex] [file...]`

|选项|描述|
|:-:|:-:|
|-i|忽略大小写|
|-v|打印不匹配的文本行|
|-c|只打印匹配或不匹配(-v选项)的行数|
|-l|打印包含匹配项的文件名,而不是文本行本身|
|-L|相似于-l项,但是只是打印不包含匹配项的文件名|
|-n|在每个匹配行之前打印出相应的行号|
|-w|只识别整个单词(即模式前后有空格)|
|-E|识别扩展正则表达式|
|-r|递归对某个目录的所有文件|
|-I|等价于-binary-files=without-match,不匹配二进制|
|-exclude-dir=[目录路径]|跳过某个目录|
|--binary-files=without-match|二进制文件不匹配|

# 正则表达式
## 正则表达式的元字

|特殊字符|用途|
|:-:|:-:|
|`.`|匹配除换行符外的任一单字符。在awk中,句点也能匹配换行符|
|`*`|匹配任一个(包括零个)在它面前的字符(包括由正则表达式指定的字符)|
|`[...]`|匹配方括号中的字符类中的任意一个。如果方括号中第一个字符为脱字符号(^),则表示否定匹配,即匹配除了换行符和类中列出的那些字符以外的所有字符。在awk中,也匹配换行符。连字符(-)用于表示字符的范围(可以连续用如[A-Za-z0-9])。如果类中的第一个字符为右方括号(])则表示它是类的成员＝所有其他的元字符在被指定为类中的成员时都会失去它们原来的含义|
|`^`|如果作为正则表达式的第一个字符,则表示匹配行的开始。在awk中匹配字符串的开始,即使字符串包含嵌入的换行符|
|`$`|如果作为正则表达式的最后一个字符,则表示匹配行的结尾。在awk中匹配字符串的结尾,即使字符串包含嵌入的换行符。|
|`\{n,m\}`|匹配它前面某个范围内单个字符出现的次数(包括由正则表达式指定的字符)。`\{n\}`将匹配n次出现,`\{n,\}`至少匹配n次出现,而且`\{n,m\}`匹配n和m之间任意次的出现|
|`\`|转义随后的特殊字符|

## POSIX字符类
POSIX是标准,通用于其它shell命令,不仅仅是正则,并且只能出现在中括号中,就是说应该这么写`[[:alnum:]]`

|类|打印字符|
|:-:|:-:|
|[:alnum:]|字母数字字符,等价于[A-Za-z0-9]|
|[:word:]|与[:alnum:]相同,但增加了下划线字符|
|[:alpha:]|字母字符|
|[:blank:]|空格和制表符|
|[:cntrl:]|控制字符,0~31和127的ASCII字符|
|[:digit:]|数字字符0~9|
|[:graph:]|可打印和可见的(非空格)字符,33-126的ASCII|
|[:lower:]|小写字符|
|[:upper:]|大写字符|
|[:print:]|可打印的字符(包括空白字符)|
|[:punct:]|标点符号字符,在 ASCII 中, 等 价 于:`-!”#$%&’()*+,./:;<=>?@[\\\]_‘| ̃`|
|[:space:]|空白字符,包括空格,tab,回车,换行,vertical tab和form feed,在ASCII中,等价于:[\t\r\n\v\f]|
|[:xdigit:]|十六进制数字|

## 扩展的元字符

|特殊字符|用途|
|:-:|:-:|
|`+`|匹配前面的正则表达式的一次或多次出现|
|`?`|匹配前面的正则表达式的零次或一次出现|
|`\|`|逻辑表达或,指定可以匹配前面的或后面的正则表达式|
|`()`|对正则表达式分组,如`^(bz|gz|zip) 和 ^bz|gz|zip`的区分,前者表示以三者之一开头的,后者表示以bz开头,或包含gz或zip|
|`{n,m}`|匹配它前面某个范围内单个字符出现的次数,与基本元字符的一样|
|`\w`|和任何可以做单词组成成分的字符匹配(字母下划线数字)|
|`\W`|和任何不能做单词组成成分的字符匹配|
|`\<`|和一个单词开头的空字符串匹配|
|`\>`|和一个单词末尾的空字符串匹配|
|`\y`|和一个单词开头的空字符串或末尾的空字符串匹配（单词边界）,这适用于awk|
|`\b`|同上，除了awk的其他软件|
|`\B`|匹配非单词边界。er\B 能匹配 verb 中的 er，但不能匹配 never 中的 er。|
|`\d`|匹配数字：[0-9]|
|`\D`|匹配非数字|
|`\s`|匹配所有空格字符，等价于`[\t\n\f\r\p{Z}]`|
|`\S`|匹配所有非空格字符|
|`p`|匹配 CR/LF（等同于 \r\n），用来匹配DOS行终止符|
|`\'`|和在缓冲区开始处的空字符串匹配|
## 零宽度断言
|符号|描述|

|:-:|:-:|
|?=|正先行断言-存在|
|?!|负先行断言-排除|
|?<=|正后发断言-存在|
|`?<!`|负后发断言-排除|
## 模式修正符

|标志|描述|
|:-:|:-:|
|i|忽略大小写。|
|g|全局搜索。|
|m|多行修饰符：锚点元字符 ^ $ 工作范围在每行的起始。|

## grep应用举例
- 打印匹配前后5行:`grep -5 'pattern' inputfile` 
- 打印匹配后5行:`grep -A 5 'pattern' inputfile`
- 打印匹配前5行:`grep -B 5 'pattern' inputfile`
- 打印匹配前5行:`grep -i 'pattern' inputfile`
## 正则表达式举例
- 引号中的任意字符串: `".*"`
- 邮箱：`^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$`
- 中国大陆手机号：`^1[3-9][[:digit:]]\{9\}$`
- 匹配任意域名：`^((http:\/\/)|(https:\/\/))?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}(\/)`
- 匹配IP地址：`((?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d?\d))`
- 汉字：`^[\u4e00-\u9fa5]{0,}$`
- 整数：`^-?[1-9]\d*$`
- 浮点数：`^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$`
- 身份证号：`^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$`
- 军官证：`^[\u4E00-\u9FA5](字第)([0-9a-zA-Z]{4,8})(号?)$`
- 护照：`^([a-zA-z]|[0-9]){5,17}$`
- 港澳通行证：`^([A-Z]\d{6,10}(\(\w{1}\))?)$`
- 台湾通行证：`^\d{8}|^[a-zA-Z0-9]{10}|^\d{18}$`
- 强密码：`^.*(?=.{6,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$`
- 火车车次：`^[GCDZTSPKXLY1-9]\d{1,4}$`
- url：`^[a-zA-Z]+:\/\/`
- Mac地址：`^([0-9a-fA-F][0-9a-fA-F]:){5}([0-9a-fA-F][0-9a-fA-F])$`
- 传真号码：`^(([0\+]\d{2,3}-)?(0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$`
- 手机号码：`^1[34578]\d{9}$`
- md5格式32位：`^[a-f0-9]{32}$`
- ipv4：`(\b25[0-5]|\b2[0-4][0-9]|\b[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}`
- ipv6：`(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))`
- email：`^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$`
- 十六进制颜色：`^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$`
- 版本号：`^\d+(?:\.\d+){2}$`
- 车牌号：`^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领][A-HJ-NP-Z](?:((\d{5}[A-HJK])|([A-HJK][A-HJ-NP-Z0-9][0-9]{4}))|[A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9挂学警港澳])$`
- 中国邮政编码：`[1-9]\d{5}(?!\d)`
- 迅雷连接：`^thunderx?:\/\/[a-zA-Z\d]+=$`
- ed2k连接：`^ed2k:\/\/\|file\|.+\|\/$`
- 磁力连接：`^magnet:\?xt=urn:btih:[0-9a-fA-F]{40,}.*$`
- html标记：`<(\S*?)[^>]*>.*?</\1>|<.*?/>`
- html注释：`<!--(.*?)-->`

