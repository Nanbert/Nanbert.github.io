---
title: 归档和备份命令
date: 2020-11-19 18:58:46
subtitle:
categories:
tags:
cover: css/images/tar.jpg
---
**<font size=4>1.压缩命令</font>**
**(a) gzip**
格式:`gzip [选项] [file]`,注意这不会保留原文件,默认输出为原文件加'.gz'后,同样解压缩也不会保留原压缩文件,注意只能对文件而不能对文件夹压缩,要走出这个误区

|选项|说明|
|:-:|:-:|
|-c|把输出写入到标注输出,并保留原始文件,注意要生成压缩文件,必须重定向到一个文件,这个选项就是这么令人费解|
|-d|解压缩,等价于gunzip|
|-f|强制压缩,即使原始文件已经被压缩|
|-h|显示用法信息|
|-k|保留原文件|
|-l|列出每个被压缩文件的压缩数据|
|-r|若命令的一个或多个参数是目录,则递归地压缩目录中的文件|
|-t|测试压缩文件的完整性|
|-v|显示压缩过程的信息|
|-[number]|设置压缩指数,[number]为1(最快,最小压缩)到9(最慢,最大压缩),默认为6|

例子:
`gunzip -c foo.txt.gz | less`这可以不解压直接查看内容

**(b) bzip2**
bzip2程序程序和gzip一样,但是不支持`-r`递归选项,同时它压缩率更大,速度更慢

**<font size=4>2.归档:tar</font>**
.tar为普通的tar包,.tgz为压缩过的tar包
格式:`tar [options] [destination] [target]`

|options|作用|
|:-:|:-:|
|c|Create创建新归档文件,存在则覆盖|
|t|Table列表,磁带文件名列表|
|d|磁带与文件系统的不同|
|r|添加文件至磁带末尾|
|u|只添加更新的文件|
|x|extract抽取,抽取文件|
|v|verbose冗长|
|f|必须指定归档文件名,必须包含该选项|
|z|gzip算法压缩|
|j|bzip2算法压缩|

`--wildcards`
提取某个文件而不是全部(见例子)时一般不支持文件通配符,可通过--wildcards来支持,如:
`tar xf xx.tar --wildcards 'home/me/dir-\*/file'`
`--file-from(-T)`
这个选项导致tar命令从一个文件而不是命令行来读入它的路径名列表,可以是标准输入,例如:
`find ~ -name 'file-A'| tar cf - --files-from= -| gzip >playground.tgz`
注意上面这个例子中第一个'-'表示标准输出,第二个则是标准输入(广泛用于其他程序),上面可以不用第二个管道,直接加个z选项即可,如下:
`find playground -name 'file-A' | tar czf playground.tgz -T -`
b.举例:
`tar cvf my.tar *.[ch] makefile`不压缩创建
`tar xvf tar_file -C destination_direectory`提取文件至指定文件夹
`tar xf my.tar home/file`只提取归档文件某一文件(前提归档文件里必须有)

**<font size=4>3.归档和压缩二合一:zip</font>**
格式:`zip [options] [destination] [origin]`
<font color=#FF0000>对于目录必须加-r选项,否则只是空目录</font>,它最优化决定是否压缩文件
`-@选项`
用来接受从标准输入的列表,例:
`find playground -name "fileA" | zip -@ file-A.zip`
例子:
`unzip -l playground.zip playground/fileA`列出指定一个文件夹
`unzip playground.zip playground/fileA`提取指定一个文件夹

**<font size=4>4.同步rsync</font>**
格式:`rsync [options] [source] [destination]`
rsync会比较两者差异,最小化的复制修改以同步
这里source和destination是下列选项之一:
·一个本地文件或目录
·一个远端文件或目录,以[user@]host:path的形式存在
·一个远端rsync服务器,由rsync://[user@]host[:port]/path指定
source和destination至少有一个本地文件,不支持远端到远端
最常见的例子如下:
`rsync -av --delete /etc /home /usr/local /media/BigDisk/backup`
`-a`表示递归和保护文件属性,`-v`表示冗余输出,`--delete`表示删除可能在备份中已经存在但却不再存在于源设备中
<font color=#FF0000>rsync还支持远端ssh,以及专门有rsync服务器有待研究</font>

