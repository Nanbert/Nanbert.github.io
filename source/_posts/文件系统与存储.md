---
title: 文件系统与存储
date: 2021-10-21 21:06:28
subtitle:
categories:
tags:
cover:
---
原始磁盘->创建分区(划分磁盘)->在各个分区上创建文件系统->挂载文件系统
### 创建分区->fdisk和cfdisk
cfdisk更加界面友好一点
* 查看当前系统所有设备`fdisk -l`
* 对某个设备进行分区`fdisk [设备名]`或`cfdisk [设备名]`,注意设备名后面不加数字,加数字的都是该设备上的某分区,如:**/dev/sda是设备,/dev/sda1则是已分好的分区**,(之后进入工具,有关知识待实践)

### 创建文件系统->mkfs.*
目前流行的系统有:ext4(mkfs.ext4),zfs(mkfs.zfs),btrfs(mkfs.btrfs)
`mkfs.* [分区名]`分区名有数字,这会格式化分区后建文件系统

### 挂载文件系统->mount
`mount -t [ext4、zfs、btrfs] [设备名] [目录]`把已经建好文件系统的分区挂载到指定目录

### 文件系统的检查与修复->fsck
fsck检查文件系统时,文件系统必须未挂载,fsck使用/etc/fstab文件自动检查文件系统类型,如果/etc/fstab里没有该文件系统分区的信息,需要加-t选项指明文件系统类型,如下:
`fsck -t ext4 /dev/sdb1`

## 逻辑卷
逻辑卷可以把不同物理设备上的分区,结合起来,动态增加文件系统大小:下面是类比
物理卷(实质上是各个原始分区)->卷组(多个物理卷)->逻辑卷(在卷组基础上加上逻辑关联,新成整体)。
物理设备->某个原始分区->文件系统。
Linux系统将一个逻辑卷视为一个物理分区,格式化一个文件系统后可以挂载

### pvcreate转化物理分区为物理卷
`sudo pvcreate /dev/sdb1`这实际只是标记该分区为一个物理卷
`sudo pvdisplay /dev/sdb1`显示物理卷的详细信息

### vgcreate创建卷组
`sudo vgcreate Vol1 /dev/sdb1 /dev/sdx`将两个物理卷创建到一个卷组
`sudo vgdisplay Vol1`查看卷组信息

### lvcreate创建逻辑卷
`sudo lvcreate -l 100%FREE -n lvtest Vol1`在卷组上创建逻辑卷,-l制定多少可用的卷组空间,以百分比表示,-L选项以字节为单位,-n制定逻辑卷的名字,更多选项看man(有待研究)
`sudo lvdisplay Vol1`查看逻辑卷

### 创建文件系统
`sudo mkfs.ext4 /dev/Vol1/lvtest`创建文件系统
`sudo mount /dev/Vol1/lvtest /mnt`挂载
注意:路径中同时指明了卷组名和逻辑卷名

### 修改逻辑卷(待建)
* vgchange 激活和禁用卷组
* vgremove 删除卷组
* vgextend 将物理卷加到卷组中
* vgreduce 从卷组中删除物理卷
* lvextend 增加逻辑卷的大小
* lvreduce 减小逻辑卷的大小

## 一些tips

### windows下U盘只读不可写问题
a.`df -h`查找挂载点
b.`sudo umount 位置`卸载U盘而不拔掉
c.`sudo dosfsck -v -a 文件系统分区(如:/dev/sdb1)`修复故障
d.`sudo mount 文件系统 挂载点`重新挂载

### 自动挂载磁盘:
　a.`fdisk -l`查看可挂载磁盘
　b.`df -h`查看已挂载的磁盘
　c.`blkid`获取目标磁盘的uuid和属性
　d.`vi /etc/fstab`添加开机mount,格式:UUID=xx /home/nanbert/disk ext4 defaults 1 1 

### 从现有文件创建映像文件
`genisoimage -o cd-rom.iso -R -J ~/cd-rom-files`

### CD-ROM
清除一张CD-ROM
`wodim dev=/dev/cdrw blank=fast`
写入一个映像文件进CD-ROM
`wodim dev=/dev/cdrw image.iso`
